if SERVER then
    AddCSLuaFile()
else
    local image = Material("materials/lowhealth/yummers.png")
    local sound = "lowhealth/yummers.wav"
    local showTime = 0.7
    local fadeTime = 1
    local isVisible = false
    local startTime = 0

    hook.Add("HUDPaint", "LowHealthWarning", function()
        local ply = LocalPlayer()
        if not IsValid(ply) then return end

        if ply:Health() < 50 and ply:Health() < 80 and GetConVar("hg_jesuslovesyou") == 1 then
            if not isVisible then
                startTime = CurTime()
                isVisible = true
                surface.PlaySound(sound)
            end
        else
            isVisible = false
        end

        if isVisible then
            local elapsed = CurTime() - startTime
            if elapsed < showTime + 2 * fadeTime then
                local alpha = 255

                if elapsed < fadeTime then
                    alpha = 255 * (elapsed / fadeTime)
                elseif elapsed > fadeTime + showTime then
                    alpha = 255 * (1 - ((elapsed - fadeTime - showTime) / fadeTime))
                end

                surface.SetDrawColor(255, 255, 255, alpha)
                surface.SetMaterial(image)
                local w, h = ScrW(), ScrH()
                surface.DrawTexturedRect(0, 0, w, h)
            else
                isVisible = false
            end
        end
    end)
end
